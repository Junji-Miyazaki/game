<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PubMed Keyword Search</title>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
            line-height: 1.6;
            padding: 20px;
            font-size: 18px;
        }
        .random-size {
            font-size: var(--random-size);
        }
        .hypothesis {
            background-color: #1a1a1a;
            border-left: 5px solid #4CAF50;
            padding: 10px;
            margin: 10px 0;
            font-style: italic;
        }
        #invert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0);
            pointer-events: none;
            z-index: 9999;
        }
        @keyframes invertColors {
            0%, 100% { background-color: rgba(0,0,0,0); }
            50% { background-color: rgba(255,255,255,1); }
        }
        .invert-animation {
            animation: invertColors 0.2s;
        }
    </style>
</head>
<body>
    <div id="invert-overlay"></div>
    <script>
        // キーワードリスト
        const outcomeKeywords = [
            "Cardiovascular Disease Incidence", "Cardiovascular Mortality",
            "Coronary Artery Disease", "Acute Coronary Syndrome", "Angina Pectoris",
            "Myocardial Ischemia", "Coronary Artery Calcification", "Coronary Plaque",
            "Sudden Cardiac Death", "Peripheral Artery Disease", "Aortic Disease",
            "Valvular Heart Disease", "Myocardial Infarction Incidence", "Myocardial Infarction Mortality",
            "ST-Elevation Myocardial Infarction", "Non-ST-Elevation Myocardial Infarction",
            "Acute Myocardial Infarction", "Reperfusion Injury", "Myocardial Necrosis",
            "Myocardial Troponin", "Creatine Kinase", "Left Ventricular Remodeling",
            "Post-Myocardial Infarction Complications", "Silent Myocardial Infarction",
            "Heart Failure Incidence", "Heart Failure Hospitalization",
            "Acute Heart Failure", "Chronic Heart Failure", "Systolic Dysfunction",
            "Diastolic Dysfunction", "Congestive Heart Failure", "Left Ventricular Ejection Fraction",
            "Cardiac Remodeling", "Heart Failure Exacerbation", "Heart Failure Biomarkers",
            "Stroke Incidence", "Stroke Mortality", "Ischemic Stroke Outcome",
            "Hemorrhagic Stroke Outcome", "Stroke Severity", "Stroke Recovery",
            "Stroke Rehabilitation Outcome", "Functional Outcome after Stroke",
            "Post-Stroke Disability", "Post-Stroke Cognitive Impairment",
            "Stroke Recurrence", "Long-term Stroke Prognosis", "Transient Ischemic Attack",
            "Cerebral Infarction", "Cerebral Hemorrhage", "Subarachnoid Hemorrhage",
            "Cerebral Thrombosis", "Cerebral Embolism"
        ];
        const exposureKeywords = [
            "Lead Exposure", "Mercury Poisoning", "Cadmium Toxicity", "Arsenic Contamination",
            "Aluminum Exposure", "Chromium Toxicity", "Nickel Allergy", "Copper Overload",
            "Zinc Deficiency", "Iron Overload", "Bisphenol A Exposure", "Phthalates in Environment", 
            "Pesticide Residues", "Polychlorinated Biphenyls", "Dioxins", "Perfluoroalkyl Substances",
            "Flame Retardants", "Microplastics Ingestion", "Air Pollution Particles",
            "Volatile Organic Compounds", "Hospital Admission Factors", "Length of Stay", 
            "Intensive Care Unit Treatment", "Mechanical Ventilation", "Antibiotic Therapy", 
            "Surgical Intervention", "Medication Adherence", "Patient-Nurse Ratio", 
            "Hospital-Acquired Infections", "Emergency Department Crowding", "Socioeconomic Status", 
            "Education Level", "Income Inequality", "Unemployment Impact", "Health Insurance Coverage", 
            "Access to Healthcare", "Neighborhood Deprivation", "Social Support Networks", 
            "Occupational Hazards", "Housing Conditions", "Dietary Patterns", "Nutrient Deficiencies", 
            "Omega-3 Fatty Acids Intake", "Antioxidant Consumption", "Fiber Intake", "Vitamin D Status",
            "Folic Acid Supplementation", "Protein Quality", "Glycemic Index of Diet",
            "Mediterranean Diet Adherence", "Sleep Duration", "Sleep Quality", "Sleep Apnea", "Insomnia",
            "Circadian Rhythm Disruption", "Shift Work Sleep Disorder", "Napping Habits",
            "Sleep Hygiene Practices", "Melatonin Levels", "REM Sleep Behavior Disorder",
            "Physical Activity Levels", "Sedentary Behavior", "Alcohol Consumption Patterns",
            "Smoking Status", "Stress Management Techniques", "Body Mass Index",
            "Waist Circumference", "Blood Pressure Variability", "Glycemic Control",
            "Lipid Profile"
        ];

        // PubMedで検索を行う関数
        async function searchPubMed(outcome, exposure1, exposure2) {
            const baseUrl = 'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/';
            const searchUrl = `${baseUrl}esearch.fcgi?db=pubmed&term=${encodeURIComponent(outcome)}+AND+(${encodeURIComponent(exposure1)}+OR+${encodeURIComponent(exposure2)})&retmax=1&format=json`;
            
            try {
                const searchResponse = await fetch(searchUrl);
                const searchData = await searchResponse.json();
                const id = searchData.esearchresult.idlist[0];
                
                if (id) {
                    const summaryUrl = `${baseUrl}esummary.fcgi?db=pubmed&id=${id}&format=json`;
                    const summaryResponse = await fetch(summaryUrl);
                    const summaryData = await summaryResponse.json();
                    
                    return {
                        title: summaryData.result[id].title,
                        abstract: summaryData.result[id].abstract,
                        citation: `${summaryData.result[id].sorttitle}. ${summaryData.result[id].source}. ${summaryData.result[id].pubdate}.`,
                        url: `https://pubmed.ncbi.nlm.nih.gov/${id}/`
                    };
                } else {
                    return null;
                }
            } catch (error) {
                console.error('Error searching PubMed:', error);
                return null;
            }
        }

        // ランダムにキーワードを選択する関数
        function selectRandomKeywords() {
            const outcome = outcomeKeywords[Math.floor(Math.random() * outcomeKeywords.length)];
            const exposure1 = exposureKeywords[Math.floor(Math.random() * exposureKeywords.length)];
            const exposure2 = exposureKeywords[Math.floor(Math.random() * exposureKeywords.length)];
            return [outcome, exposure1, exposure2];
        }

        // ランダムなフォントサイズを生成する関数
        function getRandomFontSize() {
            const min = 24;
            const max = 36;
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // オーディオコンテキストを作成
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // サイン波の音を鳴らし、画面を反転させる関数（修正）
        function playSoundAndInvert() {
            // 音を鳴らす
            const oscillator = audioContext.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
            // GainNodeを作成
    const gainNode = audioContext.createGain();
    // ここで音量を設定（0.0から1.0の間の値）
    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime); // 0.1は音量の10%を意味します

    // オシレーターをGainNodeに接続し、GainNodeを出力先に接続
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);

    // 音を鳴らす
    oscillator.start();
    oscillator.stop(audioContext.currentTime + 0.1);

            // 画面を反転
            const overlay = document.getElementById('invert-overlay');
            overlay.classList.add('invert-animation');
            setTimeout(() => {
                overlay.classList.remove('invert-animation');
            }, 200);
        }

        // 仮説を生成する関数
        function generateHypothesis(outcome, exposure1, exposure2) {
            const hypotheses = [
                `The combination of ${exposure1} and ${exposure2} might have a synergistic effect on ${outcome}.`,
                `Long-term exposure to ${exposure1} could potentially modify the impact of ${exposure2} on ${outcome}.`,
                `There might be a dose-dependent relationship between ${exposure1} and ${outcome}, mediated by ${exposure2}.`,
                `The effect of ${exposure1} on ${outcome} might vary depending on the presence or absence of ${exposure2}.`,
                `Interventions targeting both ${exposure1} and ${exposure2} could potentially reduce the incidence of ${outcome}.`,
                `${exposure1} might act as a risk factor for ${outcome}, while ${exposure2} could have a protective effect.`,
                `The interaction between ${exposure1} and ${exposure2} may influence the progression of ${outcome} over time.`,
                `Genetic susceptibility to ${outcome} might be modulated by environmental exposure to ${exposure1} and ${exposure2}.`,
                `Early-life exposure to ${exposure1} combined with adult exposure to ${exposure2} could increase the risk of ${outcome}.`,
                `The pathophysiological mechanisms underlying ${outcome} might involve complex interactions between ${exposure1} and ${exposure2}.`,
                `Chronic low-level exposure to both ${exposure1} and ${exposure2} might have cumulative effects on ${outcome} risk.`,
                `The timing of exposure to ${exposure1} relative to ${exposure2} could be critical in determining the risk of ${outcome}.`,
                `Epigenetic changes induced by ${exposure1} might alter the body's response to ${exposure2}, affecting ${outcome} risk.`,
                `The combination of ${exposure1} and ${exposure2} might influence the effectiveness of treatments for ${outcome}.`,
                `Population-level interventions targeting ${exposure1} might have unintended consequences on ${exposure2} and ${outcome}.`,
                `The relationship between ${exposure1}, ${exposure2}, and ${outcome} might vary across different demographic groups.`,
                `Occupational exposure to ${exposure1} combined with lifestyle factors related to ${exposure2} could synergistically affect ${outcome} risk.`,
                `The gut microbiome might mediate the effects of ${exposure1} and ${exposure2} on ${outcome} development.`,
                `Hormonal changes induced by ${exposure1} might modulate the body's susceptibility to ${exposure2}, influencing ${outcome} risk.`,
                `Chronic inflammation caused by ${exposure1} might exacerbate the effects of ${exposure2} on ${outcome} progression.`
            ];
            return hypotheses[Math.floor(Math.random() * hypotheses.length)];
        }

        // メイン処理
        async function main() {
            const resultDiv = document.getElementById('result');
            
            while (true) {
                const [outcome, exposure1, exposure2] = selectRandomKeywords();
                
                const newResultDiv = document.createElement('div');
                newResultDiv.innerHTML = `<h2 class="random-size">Search: Outcome: ${outcome}, Exposures: ${exposure1} and ${exposure2}</h2>`;
                newResultDiv.querySelector('.random-size').style.setProperty('--random-size', `${getRandomFontSize()}px`);
                resultDiv.appendChild(newResultDiv);
                
                const result = await searchPubMed(outcome, exposure1, exposure2);

                if (result) {
                    let resultHTML = `
                        <h3 class="random-size">${result.title}</h3>
                        <p class="random-size"><strong>Citation:</strong> ${result.citation}</p>
                    `;
                    
                    if (result.abstract) {
                        resultHTML += `<p class="random-size"><strong>Abstract:</strong> ${result.abstract}</p>`;
                    }
                    
                    const hypothesis = generateHypothesis(outcome, exposure1, exposure2);
                    resultHTML += `
                        <div class="hypothesis random-size"><strong>Potential Hypothesis:</strong> ${hypothesis}</div>
                        <p class="random-size"><a href="${result.url}" target="_blank">View on PubMed</a></p>
                        <hr>
                    `;
                    
                    newResultDiv.innerHTML += resultHTML;
                    newResultDiv.querySelectorAll('.random-size').forEach(el => {
                        el.style.setProperty('--random-size', `${getRandomFontSize()}px`);
                    });
                } else {
                    newResultDiv.innerHTML += '<p class="random-size">No results found or an error occurred.</p><hr>';
                    newResultDiv.querySelector('.random-size').style.setProperty('--random-size', `${getRandomFontSize()}px`);
                }

                newResultDiv.scrollIntoView({ behavior: 'smooth' });
                playSoundAndInvert();

                await new Promise(resolve => setTimeout(resolve, 3000));
            }
        }

        // ページロード時に実行
        window.onload = () => {
            const appDiv = document.createElement('div');
            appDiv.innerHTML = `
                <h1 class="random-size">PubMed Keyword Search</h1>
                <div id="result"></div>
            `;
            document.body.appendChild(appDiv);
            appDiv.querySelector('.random-size').style.setProperty('--random-size', `${getRandomFontSize()}px`);
            
            // メイン処理を開始
            main();
        };
    </script>
</body>
</html>