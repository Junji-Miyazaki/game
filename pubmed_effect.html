<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PubMed Keyword Search</title>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
            line-height: 1.6;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>PubMed Keyword Search</h1>
        <div id="result"></div>
    </div>

    <script>
        // キーワードリスト（変更なし、簡略化のため省略）
        const outcomeKeywords = ["Cardiovascular Disease Incidence", "Myocardial Infarction Incidence"];
        const exposureKeywords = ["Lead Exposure", "Mercury Poisoning"];

        // PubMedで検索を行う関数
        async function searchPubMed(keyword1, keyword2) {
            console.log(`Searching PubMed for: ${keyword1} AND ${keyword2}`);
            const baseUrl = 'https://eutils.ncbi.nlm.nih.gov/entrez/eutils/';
            const searchUrl = `${baseUrl}esearch.fcgi?db=pubmed&term=${encodeURIComponent(keyword1)}+AND+${encodeURIComponent(keyword2)}&retmax=1&format=json`;
            
            try {
                const searchResponse = await fetch(searchUrl);
                const searchData = await searchResponse.json();
                console.log('Search response:', searchData);
                const id = searchData.esearchresult.idlist[0];
                
                if (id) {
                    const summaryUrl = `${baseUrl}esummary.fcgi?db=pubmed&id=${id}&format=json`;
                    const summaryResponse = await fetch(summaryUrl);
                    const summaryData = await summaryResponse.json();
                    console.log('Summary response:', summaryData);
                    
                    return {
                        title: summaryData.result[id].title,
                        abstract: summaryData.result[id].abstract,
                        citation: `${summaryData.result[id].sorttitle}. ${summaryData.result[id].source}. ${summaryData.result[id].pubdate}.`,
                        url: `https://pubmed.ncbi.nlm.nih.gov/${id}/`
                    };
                } else {
                    console.log('No results found');
                    return null;
                }
            } catch (error) {
                console.error('Error searching PubMed:', error);
                return null;
            }
        }

        // ランダムにキーワードを選択する関数
        function selectRandomKeywords() {
            const outcome = outcomeKeywords[Math.floor(Math.random() * outcomeKeywords.length)];
            const exposure = exposureKeywords[Math.floor(Math.random() * exposureKeywords.length)];
            return [outcome, exposure];
        }

        // タイプライター効果を実現する関数
        function typeWriter(element, text, speed = 50) {
            let i = 0;
            return new Promise((resolve) => {
                function type() {
                    if (i < text.length) {
                        element.innerHTML += text.charAt(i);
                        i++;
                        setTimeout(type, speed);
                    } else {
                        resolve();
                    }
                }
                type();
            });
        }

        // メイン処理
        async function main() {
            console.log('Main function started');
            const resultDiv = document.getElementById('result');
            
            while (true) {
                const [outcome, exposure] = selectRandomKeywords();
                console.log(`Selected keywords: ${outcome}, ${exposure}`);
                const newResultDiv = document.createElement('div');
                resultDiv.appendChild(newResultDiv);
                
                await typeWriter(newResultDiv, `<h2>Search: Outcome: ${outcome}, Exposure: ${exposure}</h2>`);
                
                const result = await searchPubMed(outcome, exposure);

                if (result) {
                    await typeWriter(newResultDiv, `<h3>${result.title}</h3>`);
                    await typeWriter(newResultDiv, `<p><strong>Citation:</strong> ${result.citation}</p>`);
                    await typeWriter(newResultDiv, `<p><strong>Abstract:</strong> ${result.abstract}</p>`);
                    await typeWriter(newResultDiv, `<p><a href="${result.url}" target="_blank">View on PubMed</a></p>`);
                    await typeWriter(newResultDiv, '<hr>');
                } else {
                    await typeWriter(newResultDiv, '<p>No results found or an error occurred.</p><hr>');
                }

                // 新しい結果にスクロール
                newResultDiv.scrollIntoView({ behavior: 'smooth' });

                // 次の検索までの待機時間（ミリ秒）
                await new Promise(resolve => setTimeout(resolve, 5000));
            }
        }

        // ページロード時に実行
        window.onload = () => {
            console.log('Page loaded');
            main();
        };
    </script>
</body>
</html>